<main>
    <div class="border_left"></div>
    <div class="border_right"></div>
    <div class="center">
        <div class="textbox godfoot1">
            <p>Shifting to the Sword of Vengeance timeline we find our heros in conflict...</p>
        </div>
        <hr class="narration_break">
        <div class="textbox chef">
            <p>Get them you fools, I will advenge my brother!</p>
        </div>
        <div class="textbox grunt1">
            <p>Roger</p>
        </div>
        <div class="textbox grunt2">
            <p>Roger</p>
        </div>
        <div class="textbox magic_rat">
            <p>Dam it!, Chef has allied with the Rancore and now he's sticking there damn Grunts on us.</p>
        </div>
        <div class="textbox niko">
            <p>Don't worry brother we can take em on, no problem!</p>
        </div>
        <div class="textbox magic_rat">
            <p>Alright, lets take on these Ran-cowards</p>
        </div>
        <div class="animation_box" id="magic_rat_animation"></div>
        <div class="textbox niko">
            <p>Nice work brother! Now I'll take one on head on.</p>
        </div>
        <div class="textbox niko">
            <p>Ahhhhhhhhhhh!</p>
        </div>
        <div class="animation_box" id="niko_animation"></div>
        <div class="textbox magic_rat">
            <p>Damn, you really did a number on that one! But brother, it appears
                you took some shots!
            </p>
        </div>
        <div class="textbox niko">
            <p>Ha, it is but a scratch</p>
        </div>
        <div class="textbox chef">
            <p>DON"T FORGET ABOUT ME!!!</p>
        </div>
        <div class="textbox magic_rat">
            <p>Shoot we still got this dang horse bitch!</p>
        </div>
        <div class="textbox niko">
            <p>Not to worry, we can take him one lickity split!</p>
        </div>
        <div class="textbox chef">
            <p>I DONT THINK SO BUSTER</p>
        </div>
        <div class="textbox dues">
            <p>*snap</p>
        </div>
        <div class="textbox magic_rat disappear">
            <p>Wait, what's going on here!</p>
        </div>
        <div class="textbox niko disappear">
            <p>BROTHER!</p>
        </div>
        <div class="textbox chef disappear">
            <p>HOLY FUCKING SHIT!</p>
        </div>
        <page_controls></page_controls>
    </div>
</main>

<script>
    const CHARACTER_WIDTH_PERCENT = 5

    document.addEventListener("DOMContentLoaded", ()=>{
        magicRatAnimation()
        nikoAnimation()
    })

    function createCharacterImg(src){
        let img = document.createElement("img")
        img.setAttribute("src",src)
        img.style.position = "absolute"
        img.style.width = `${CHARACTER_WIDTH_PERCENT}%`
        img.style.bottom = "0%"
        return img
    }

    function createBullet(){
        let bullet = document.createElement("div")
        bullet.style.top = "70%"
        bullet.style.height = "5%"
        bullet.style.width = "2%"
        bullet.style.position = "absolute"
        return bullet
    }

    function moveBullet(bullet,i){
        if (i%2==0){
            bullet.style.backgroundColor = "red"
        }else{
            bullet.style.backgroundColor = "yellow"
        }
        if(i <16){
            bullet.style.left = `${60-4*i}%`
        }else{
            bullet.style.visibility = "hidden" 
        }

    }

    function magicRatAnimation(){
        let rat_img = createCharacterImg("/front_end/static/imgs/character_sheets/magic_rat/right1.png")
        let grunt_img = createCharacterImg("/front_end/static/imgs/character_sheets/grunt1/left1.png")
        let bullet = createBullet()
        let sword = document.createElement("div")
        sword.style.position = "absolute"
        sword.style.background = 'linear-gradient(180deg, silver 50%, rgba(1,1,1,0) 50%)'
        sword.style.left = "67.5%"
        sword.style.width = ".4%"
        sword.style.height = "80%"
        sword.style.top = "25%"
        let canvas = document.getElementById("magic_rat_animation")
        canvas.style.background = "url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fthumbs.dreamstime.com%2Fb%2Fspaceship-interior-view-distant-planets-system-d-render-white-blue-space-rendering-elements-image-95289284.jpg&f=1&nofb=1)"
        canvas.style.backgroundSize = "100% 100%"
        canvas.appendChild(rat_img)
        canvas.appendChild(grunt_img)
        canvas.appendChild(bullet)
        canvas.appendChild(sword)
        let i = 0
        setInterval(function(){
            if (i < 11){
                rat_img.src = "/front_end/static/imgs/character_sheets/magic_rat/right1.png"
                rat_img.style.left = "20%"
                rat_img.style.opacity = 1-.1*i
                grunt_img.style.bottom = "0%"
                grunt_img.style.left = "60%"
                grunt_img.style.transform = "rotate(0deg)"
                sword.style.visibility = "hidden"
                bullet.style.visibility = "visible" 
            }else if(i<22){
                rat_img.src = "/front_end/static/imgs/character_sheets/magic_rat/left1.png"
                rat_img.style.left = "65%"
                rat_img.style.opacity = .1*(i-11)
            }else if(i<28){
                grunt_img.style.transform = `rotate(-${90*(i-22)/5}deg)`
                grunt_img.style.bottom = `${CHARACTER_WIDTH_PERCENT/(i-22)-8}%`
                grunt_img.style.left = `${60-2*(i-22)}%`
                sword.style.visibility = "visible"
                sword.style.transform = `rotate(-${150*(i-22)/5}deg)`
            }else if(i>30){
                i = 0
            }
            moveBullet(bullet,i)
            i++
            }, 70)
    }

    function nikoAnimation(){
        let niko_img = createCharacterImg("/front_end/static/imgs/character_sheets/niko/right1.png")
        let grunt_img = createCharacterImg("/front_end/static/imgs/character_sheets/grunt2/left1.png")
        let canvas = document.getElementById("niko_animation")
        let bullets = [createBullet()]
        canvas.style.background = "url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fthumbs.dreamstime.com%2Fb%2Fspaceship-interior-view-distant-planets-system-d-render-white-blue-space-rendering-elements-image-95289284.jpg&f=1&nofb=1)"
        canvas.style.backgroundSize = "100% 100%"
        canvas.appendChild(niko_img)
        canvas.appendChild(grunt_img)
        canvas.appendChild(bullets[0])
        let i = 0
        let bulletSpacer = 0
        setInterval(function(){
            if (i<12){
                niko_img.style.left = `${i*4+10}%`
                niko_img.src = `/front_end/static/imgs/character_sheets/niko/right${i%3}.png`
                grunt_img.style.left = "60%"
                grunt_img.style.transform = "rotate(0deg)"
                niko_img.style.transform = "rotate(0deg)"
                if(i<6){
                    bullets.push(createBullet())
                    canvas.appendChild(bullets[bullets.length-1])
                }else if(bullets.length >0){
                    canvas.removeChild(bullets.shift())
                    bulletSpacer +=1
                }
                bullets.forEach((b,index)=>moveBullet(b,i-index-bulletSpacer))
            }else if (i<30){
                grunt_img.style.transform = `rotate(${90*(i-12)/5}deg)`
                grunt_img.style.bottom = `${CHARACTER_WIDTH_PERCENT/(i-12)-8}%`
                grunt_img.style.left = `${64+2*(i-12)}%`

            }else{
                i=0
                bulletSpacer = 0
            }
            i++
        },70)
    }
</script>